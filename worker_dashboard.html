<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillConnect | Worker Dashboard & Live Jobs</title>
    
    <link rel="stylesheet" href="worker_dashboard2.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        // ⚠️ USE YOUR LIVE FIREBASE PROJECT CONFIG DETAILS HERE ⚠️
        // These are the same configuration details used for the Employer Dashboard
        const firebaseConfig = {
            apiKey: "AIzaSyD6Kn44-ilM8DoCrzUFwoVYyd4GmuDcsFE",
            authDomain: "skillconnect-f6632.firebaseapp.com",
            projectId: "skillconnect-f6632",
            storageBucket: "skillconnect-f6632.firebasestorage.app",
            messagingSenderId: "462430536837",
            appId: "1:462430536837:web:4e6a791ca9b462a29895ec",
            measurementId: "G-VY0EH70WR9"
        };

        // Initialize Firebase and Firestore
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /**
         * Fetches job listings from the 'jobs' collection and renders them on the page.
         */
        function loadJobs() {
            const jobsContainer = document.getElementById('live-job-listings');
            jobsContainer.innerHTML = '<h2>Loading Job Opportunities...</h2>'; // Loading message

            db.collection("jobs").get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        jobsContainer.innerHTML = '<h2>No jobs currently posted. Check back soon!</h2>';
                        return;
                    }

                    // Clear loading message and prepare to build the list
                    jobsContainer.innerHTML = '';
                    
                    querySnapshot.forEach((doc) => {
                        const job = doc.data();
                        
                        // Construct the main job title string
                        const jobTitle = `${job.skill_required} (${job.skill_level})`;

                        // Determine an icon based on skill (simple example)
                        let iconClass = 'fas fa-briefcase'; // Default icon
                        if (job.skill_required.includes('Cook')) iconClass = 'fas fa-utensils';
                        else if (job.skill_required.includes('Electrician')) iconClass = 'fas fa-bolt';
                        else if (job.skill_required.includes('Web Development')) iconClass = 'fas fa-code';
                        
                        // Create the HTML structure for one job card
                        const cardHTML = `
                            <div class="job-card" data-job-id="${doc.id}">
                                <h3>
                                    ${jobTitle} 
                                    <i class="${iconClass} icon-right"></i>
                                </h3>
                                <p>${job.job_statement}</p>
                                
                                <div class="job-meta">
                                    <p><strong><i class="fas fa-map-marker-alt"></i> Location:</strong> ${job.job_location}</p>
                                    <p><strong><i class="fas fa-clock"></i> Duration:</strong> ${job.job_duration}</p>
                                    <p><strong><i class="fas fa-building"></i> Employer:</strong> ${job.employer_name}</p>
                                </div>
                                
                                <button class="apply-button">Apply</button>
                            </div>
                        `;
                        
                        // Add the card to the container
                        jobsContainer.innerHTML += cardHTML;
                    });
                })
                .catch((error) => {
                    console.error("Error loading jobs: ", error);
                    jobsContainer.innerHTML = '<h2>Failed to load jobs. Check console for error details.</h2>';
                });
        }
        
        // Load the jobs as soon as the page is ready
        window.onload = loadJobs;
    </script>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo">SkillConnect</h1>
            <nav class="main-nav">
                <ul>
                    <li><a href="#messages">Messages</a></li>
                    <li><a href="#history">History</a></li>
                    <li><a href="#myjobs">My Jobs</a></li>
                    <li><a href="#applications">Applications</a></li>
                    <li><a href="employer_dashboard.html" class="nav-link">Employer Posts</a></li>
                    <li class="profile-dropdown">
                        <a href="#profile" class="profile-icon">
                            <img src="https://via.placeholder.com/30/808080/FFFFFF?text=DP" alt="Profile Picture">
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content container">
        <h2 style="font-family: 'Poppins', sans-serif; color: #3a332d; border-bottom: 2px solid #e0d9cf; padding-bottom: 10px; margin-bottom: 20px;">Available Job Listings</h2>
        
        <div class="job-listings" id="live-job-listings">
            </div>
    </main>
</body>
</html>